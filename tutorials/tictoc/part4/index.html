



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Docmentation for the OMNeT++ Simulator">
      
      
        <link rel="canonical" href="https://docs.omnetpp.org/tutorials/tictoc/part4/">
      
      
        <meta name="author" content="OMNeT++ Team">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Turning it Into a Real Network - OMNeT++ Technical Articles</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
    
      <script src="../../../assets/javascripts/modernizr.268332fc.js"></script>
    
    <script>
    // handle <a srcfile></a> references to source files
    document.addEventListener("DOMContentLoaded", function (event) {
        $('a[srcfile]').each(function(i) {
            var srcref = $(this).attr('srcfile');
            var name = srcref.replace(/.*\//g, "");
            $(this).text(name);
            $(this).attr('href', '/showfile/?url='+srcref);
            $(this).attr('target', '_blank');
        });
    });
    // function th show a full size image when clicked ona thumbnail
    imageFullSizeZoom = function(img){
        img = $(img);
        let fullSizeSrc = img.attr('src').replace(/.thumb.jpg$/, '.png');

        $(document.body).append(
        '<div class="fullscreenimgshade" onclick="$(this).remove();">' +
            '<img src="' + fullSizeSrc + '" class="fullscreenimg"/>' +
        '</div>'
        );
    };
    </script>

    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../stylesheets/omnetpp-docs.css">
    
      <link rel="stylesheet" href="../../../stylesheets/rainbow.css">
    
      <link rel="stylesheet" href="../../../stylesheets/rainbow.linenumbers.theme.css">
    
      <link rel="stylesheet" href="../../../stylesheets/jupyter.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-240922-2", "docs.omnetpp.org")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#part-4-turning-it-into-a-real-network" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://docs.omnetpp.org/" title="OMNeT++ Technical Articles" class="md-header-nav__button md-logo">
          
            <i class="md-icon">î Œ</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              OMNeT++ Technical Articles
            </span>
            <span class="md-header-nav__topic">
              
                Turning it Into a Real Network
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/omnetpp/docs.omnetpp.org/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    omnetpp/docs.omnetpp.org
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon md-icon--home"></i>
      
    </span>
    OMNeT++ Technical Articles
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/omnetpp/docs.omnetpp.org/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    omnetpp/docs.omnetpp.org
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
        
        
        


  <li class="md-nav__item">
    <a href="../../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

      
    
      
        
        
        

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" checked>
    
    <label class="md-nav__link" for="nav-2-1">
      Learn OMNeT++ with TicToc
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Learn OMNeT++ with TicToc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../part1/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../part2/" title="Running the Simulation" class="md-nav__link">
      Running the Simulation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../part3/" title="Enhancing the 2-node TicToc" class="md-nav__link">
      Enhancing the 2-node TicToc
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Turning it Into a Real Network
      </label>
    
    <a href="./" title="Turning it Into a Real Network" class="md-nav__link md-nav__link--active">
      Turning it Into a Real Network
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#41-more-than-two-nodes" class="md-nav__link">
    4.1 More than two nodes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-channels-and-inner-type-definitions" class="md-nav__link">
    4.2 Channels and inner type definitions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-using-two-way-connections" class="md-nav__link">
    4.3 Using two-way connections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-defining-our-message-class" class="md-nav__link">
    4.4 Defining our message class
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../part5/" title="Adding Statistics Collection" class="md-nav__link">
      Adding Statistics Collection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../part6/" title="Visualizing the Results" class="md-nav__link">
      Visualizing the Results
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../part7/" title="Parameter Studies" class="md-nav__link">
      Parameter Studies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../conclusion/" title="Closing words" class="md-nav__link">
      Closing words
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pandas/" title="Result Analysis with Python" class="md-nav__link">
      Result Analysis with Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
    
      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Articles
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Articles
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Introduction into Running Simulations in the Cloud
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Introduction into Running Simulations in the Cloud
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/page1/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/page2/" title="Implementation" class="md-nav__link">
      Implementation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/page4/" title="Deploying on AWS" class="md-nav__link">
      Deploying on AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/page5/" title="Trying It Out" class="md-nav__link">
      Trying It Out
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/page6/" title="Examining the Code" class="md-nav__link">
      Examining the Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud/page7/" title="Potential Improvements, Alternatives" class="md-nav__link">
      Potential Improvements, Alternatives
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Using AWS for Running INET Simulation Campaigns
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Using AWS for Running INET Simulation Campaigns
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../swarm/" title="Motivation" class="md-nav__link">
      Motivation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../swarm/page1/" title="Installation and Usage" class="md-nav__link">
      Installation and Usage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../swarm/page2/" title="How it Works" class="md-nav__link">
      How it Works
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/porting-code-into-omnetpp/" title="Porting Real-World Protocol Implementations into OMNeT++" class="md-nav__link">
      Porting Real-World Protocol Implementations into OMNeT++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/building-omnetpp-in-docker/" title="Building an OMNeT++ Distro" class="md-nav__link">
      Building an OMNeT++ Distro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/running-omnetppgui-in-docker/" title="OMNeT++ GUI in Docker" class="md-nav__link">
      OMNeT++ GUI in Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/running-omnetpp-in-docker/" title="Using Docker for Running Simulations on Various Versions of OMNeT++" class="md-nav__link">
      Using Docker for Running Simulations on Various Versions of OMNeT++
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/wsl2/" title="Installing OMNeT++ on Windows Subsystem for Linux (WSL 2)" class="md-nav__link">
      Installing OMNeT++ on Windows Subsystem for Linux (WSL 2)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/omnetpp-debugging-tips/" title="Improving the C++ Debugging Experience on Linux and other OSes" class="md-nav__link">
      Improving the C++ Debugging Experience on Linux and other OSes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
    
      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Proposed Research Topics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Proposed Research Topics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/neuralnet-errormodels/" title="Better Wireless Error Models Using Neural Networks" class="md-nav__link">
      Better Wireless Error Models Using Neural Networks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../articles/zero-conf-parsim/" title="Zero Configuration Automatic Parallel Simulation" class="md-nav__link">
      Zero Configuration Automatic Parallel Simulation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
    
      
    
      
    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#41-more-than-two-nodes" class="md-nav__link">
    4.1 More than two nodes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-channels-and-inner-type-definitions" class="md-nav__link">
    4.2 Channels and inner type definitions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-using-two-way-connections" class="md-nav__link">
    4.3 Using two-way connections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-defining-our-message-class" class="md-nav__link">
    4.4 Defining our message class
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/omnetpp/docs.omnetpp.org/edit/master/docs/tutorials/tictoc/part4.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="part-4-turning-it-into-a-real-network">Part 4 - Turning it Into a Real Network<a class="headerlink" href="#part-4-turning-it-into-a-real-network" title="Permanent link">&para;</a></h1>
<h2 id="41-more-than-two-nodes">4.1 More than two nodes<a class="headerlink" href="#41-more-than-two-nodes" title="Permanent link">&para;</a></h2>
<p>Now we'll make a big step: create several <code class="codehilite"><span class="err">tic</span></code> modules and connect
them into a network. For now, we'll keep it simple what they do:
one of the nodes generates a message, and the others keep tossing
it around in random directions until it arrives at
a predetermined destination node.</p>
<p>The NED file will need a few changes. First of all, the <code class="codehilite"><span class="err">Txc</span></code> module will
need to have multiple input and output gates:</p>
<pre class="snippet" src="../code/tictoc10.ned" from="simple Txc10" upto="output out\[\];\n}"></pre>

<p>The <code class="codehilite"><span class="err">[ ]</span></code> turns the gates into gate vectors. The size of the vector
(the number of gates) will be determined where we use Txc to build
the network.</p>
<pre class="snippet" src="../code/tictoc10.ned" from="network Tictoc10" upto="tic\[5\].out\+\+;\n}"></pre>

<p>Here we created 6 modules as a module vector, and connected them.</p>
<p>The resulting topology looks like this:</p>
<p><img src="../images/step10.png"></p>
<p>In this version, <code class="codehilite"><span class="err">tic[0]</span></code> will generate the message to be sent around.
This is done in <code class="codehilite"><span class="err">initialize()</span></code>, with the help of the <code class="codehilite"><span class="err">getIndex()</span></code> function which
returns the index of the module in the vector.</p>
<p>The meat of the code is the <code class="codehilite"><span class="err">forwardMessage()</span></code> function which we invoke
from <code class="codehilite"><span class="err">handleMessage()</span></code> whenever a message arrives at the node. It draws
a random gate number, and sends out message on that gate.</p>
<pre class="snippet" src="../code/txc10.cc" from="void Txc10::forwardMessage" upto="k\);\n}"></pre>

<p>When the message arrives at <code class="codehilite"><span class="err">tic[3]</span></code>, its <code class="codehilite"><span class="err">handleMessage()</span></code> will delete the message.</p>
<p>See the full code in <a srcfile="tutorials/tictoc/code/txc10.cc"></a></p>
<div class="admonition tip">
<p class="admonition-title">Exercise</p>
<p>You'll notice that this simple "routing" is not very efficient:
often the packet keeps bouncing between two nodes for a while before it is sent
to a different direction. This can be improved somewhat if nodes don't send
the packet back to the sender. Implement this. Hints: <code class="codehilite"><span class="c">cMessage::getArrivalGate()</span></code>,
<code class="codehilite"><span class="c">cGate::getIndex()</span></code>. Note that if the message didn't arrive via a gate but was
a self-message, then <code class="codehilite"><span class="err">getArrivalGate()</span></code> returns <code class="codehilite"><span class="err">NULL</span></code>.</p>
</div>
<p>Sources: <a srcfile="tutorials/tictoc/code/tictoc10.ned"></a>, <a srcfile="tutorials/tictoc/code/txc10.cc"></a>, <a srcfile="tutorials/tictoc/code/omnetpp.ini"></a></p>
<h2 id="42-channels-and-inner-type-definitions">4.2 Channels and inner type definitions<a class="headerlink" href="#42-channels-and-inner-type-definitions" title="Permanent link">&para;</a></h2>
<p>Our new network definition is getting quite complex and long, especially
the connections section. Let's try to simplify it. The first thing we
notice is that the connections always use the same <code class="codehilite"><span class="err">delay</span></code> parameter.
It is possible to create types for the connections (they are called channels)
similarly to simple modules. We should create a channel type which specifies the
delay parameter and we will use that type for all connections in the network.</p>
<pre class="snippet" src="../code/tictoc11.ned" from="network Tictoc11" upto="submodules"></pre>

<p>As you have noticed we have defined the new channel type inside the network definition
by adding a <code class="codehilite"><span class="err">types</span></code> section. This type definition is only visible inside the
network. It is called as a local or inner type. You can use simple modules as inner types
too, if you wish.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We have created the channel by specializing the built-in <code class="codehilite"><span class="err">DelayChannel</span></code>.
(built-in channels can be found inside the <code class="codehilite"><span class="err">ned</span></code> package. Thats why we used
the full type name <code class="codehilite"><span class="err">ned.DelayChannel</span></code>) after the <code class="codehilite"><span class="err">extends</span></code> keyword.</p>
</div>
<p>Now let's check how the <code class="codehilite"><span class="err">connections</span></code> section changed.</p>
<pre class="snippet" src="../code/tictoc11.ned" from="connections:" upto="tic\[5\].out\+\+;\n}"></pre>

<p>As you see we just specify the channel name inside the connection definition.
This allows to easily change the delay parameter for the whole network.</p>
<p>Sources: <a srcfile="tutorials/tictoc/code/tictoc11.ned"></a>, <a srcfile="tutorials/tictoc/code/txc11.cc"></a>, <a srcfile="tutorials/tictoc/code/omnetpp.ini"></a></p>
<h2 id="43-using-two-way-connections">4.3 Using two-way connections<a class="headerlink" href="#43-using-two-way-connections" title="Permanent link">&para;</a></h2>
<p>If we check the <code class="codehilite"><span class="err">connections</span></code> section a little more, we will realize that
each node pair is connected with two connections. One for each direction.
OMNeT++ 4 supports two way connections, so let's use them.</p>
<p>First of all, we have to define two-way (or so called <code class="codehilite"><span class="err">inout</span></code>) gates instead of the
separate <code class="codehilite"><span class="err">input</span></code> and <code class="codehilite"><span class="err">output</span></code> gates we used previously.</p>
<pre class="snippet" src="../code/tictoc12.ned" from="simple Txc12" upto="declare two way connections\n}"></pre>

<p>The new <code class="codehilite"><span class="err">connections</span></code> section would look like this:</p>
<pre class="snippet" src="../code/tictoc12.ned" from="connections:" upto="tic\[5\].gate\+\+;\n}"></pre>

<p>We have modified the gate names so we have to make some modifications to the
C++ code.</p>
<pre class="snippet" src="../code/txc12.cc" from="void Txc12::forwardMessage" upto="k\);\n}"></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The special $i and $o suffix after the gate name allows us to use the
connection's two direction separately.</p>
</div>
<p>Sources: <a srcfile="tutorials/tictoc/code/tictoc12.ned"></a>, <a srcfile="tutorials/tictoc/code/txc12.cc"></a>, <a srcfile="tutorials/tictoc/code/omnetpp.ini"></a></p>
<h2 id="44-defining-our-message-class">4.4 Defining our message class<a class="headerlink" href="#44-defining-our-message-class" title="Permanent link">&para;</a></h2>
<p>In this step the destination address is no longer hardcoded <code class="codehilite"><span class="err">tic[3]</span></code> -- we draw a
random destination, and we'll add the destination address to the message.</p>
<p>The best way is to subclass cMessage and add destination as a data member.
Hand-coding the message class is usually tedious because it contains
a lot of boilerplate code, so we let OMNeT++ generate the class for us.
The message class specification is in <code class="codehilite"><span class="err">tictoc13.msg</span></code>:</p>
<pre class="snippet" src="../code/tictoc13.msg" from="message TicTocMsg13" upto="}"></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a href="https://doc.omnetpp.org/omnetpp/manual/#cha:msg-def" target="_blank">Section 6</a> of the OMNeT++ manual for more details on messages.</p>
</div>
<p>The makefile is set up so that the message compiler, opp_msgc is invoked
and it generates <code class="codehilite"><span class="err">tictoc13_m.h</span></code> and <code class="codehilite"><span class="err">tictoc13_m.cc</span></code> from the message declaration
(The file names are generated from the <code class="codehilite"><span class="err">tictoc13.msg</span></code> file name, not the message type name).
They will contain a generated <code class="codehilite"><span class="err">TicTocMsg13</span></code> class subclassed from [<code class="codehilite"><span class="err">cMessage</span></code>];
the class will have getter and setter methods for every field.</p>
<p>We'll include <code class="codehilite"><span class="err">tictoc13_m.h</span></code> into our C++ code, and we can use <code class="codehilite"><span class="err">TicTocMsg13</span></code> as
any other class.</p>
<pre class="snippet" src="../code/txc13.cc" after="cMessage" upto="tictoc13_m.h"></pre>

<p>For example, we use the following lines in <code class="codehilite"><span class="err">generateMessage()</span></code> to create the
message and fill its fields.</p>
<pre class="snippet" src="../code/txc13.cc" from="TicTocMsg13 \*msg = new TicTocMsg13\(msgname\);" upto="return msg;"></pre>

<p>Then, <code class="codehilite"><span class="err">handleMessage()</span></code> begins like this:</p>
<pre class="snippet" src="../code/txc13.cc" from="void Txc13::handleMessage\(" upto="getDestination"></pre>

<p>In the argument to handleMessage(), we get the message as a <code class="codehilite"><span class="err">cMessage*</span></code> pointer.
However, we can only access its fields defined in <code class="codehilite"><span class="err">TicTocMsg13</span></code> if we cast
msg to <code class="codehilite"><span class="err">TicTocMsg13*</span></code>. Plain C-style cast (<code class="codehilite"><span class="err">(TicTocMsg13 *)msg</span></code>)
is not safe because if the message is <em>not</em> a <code class="codehilite"><span class="err">TicTocMsg13</span></code> after all
the program will just crash, causing an error which is difficult to explore.</p>
<p>C++ offers a solution which is called <code class="codehilite"><span class="err">dynamic_cast</span></code>. Here we use <code class="codehilite"><span class="err">check_and_cast&lt;&gt;()</span></code>
which is provided by OMNeT++: it tries to cast the pointer via <code class="codehilite"><span class="err">dynamic_cast</span></code>,
and if it fails it stops the simulation with an error message, similar to the
following:</p>
<p><img src="../images/step13e.png"></p>
<p>In the next line, we check if the destination address is the same as the
node's address. The <code class="codehilite"><span class="err">getIndex()</span></code> member function returns the index
of the module in the submodule vector (remember, in the NED file we
declarared it as <code class="codehilite"><span class="err">tic[6]: Txc13</span></code>, so our nodes have addresses 0..5).</p>
<p>To make the model execute longer, after a message arrives to its destination
the destination node will generate another message with a random destination
address, and so forth. Read the full code: <a srcfile="tutorials/tictoc/code/txc13.cc"></a></p>
<p>When you run the model, it'll look like this:</p>
<p><img src="../images/step13a.png"></p>
<p>You can click on the messages to see their content in the inspector window.
Double-clicking will open the inspector in a new window.
(You'll either have to temporarily stop the simulation for that,
or to be very fast in handling the mouse). The inspector window
displays lots of useful information; the message fields can be seen
on the <em>Contents</em> page.</p>
<p><img src="../images/step13b.png"></p>
<p>Sources: <a srcfile="tutorials/tictoc/code/tictoc13.ned"></a>, <a srcfile="tutorials/tictoc/code/tictoc13.msg"></a>, <a srcfile="tutorials/tictoc/code/txc13.cc"></a>, <a srcfile="tutorials/tictoc/code/omnetpp.ini"></a></p>
<div class="admonition tip">
<p class="admonition-title">Exercise</p>
<p>In this model, there is only one message underway at any
given moment: nodes only generate a message when another message arrives
at them. We did it this way to make it easier to follow the simulation.
Change the module class so that instead, it generates messages periodically.
The interval between messages should be a module parameter, returning
exponentially distributed random numbers.</p>
</div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../part3/" title="Enhancing the 2-node TicToc" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Enhancing the 2-node TicToc
              </span>
            </div>
          </a>
        
        
          <a href="../part5/" title="Adding Statistics Collection" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Adding Statistics Collection
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 OpenSim Ltd.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="http://omnetpp.org" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/omnetpp/docs.omnetpp.org" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/omnetpp" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../javascripts/jquery-3.2.1.min.js"></script>
      
        <script src="../../../javascripts/quoting.js"></script>
      
        <script src="../../../javascripts/rainbow-custom.min.js"></script>
      
        <script src="../../../javascripts/rainbow.linenumbers.min.js"></script>
      
        <script src="../../../javascripts/rainbow-ini.js"></script>
      
        <script src="../../../javascripts/rainbow-ned.js"></script>
      
        <script src="../../../javascripts/rainbow-yaml.js"></script>
      
        <script src="../../../javascripts/rainbow-dockerfile.js"></script>
      
        <script src="../../../javascripts/rainbow-html.js"></script>
      
    
  </body>
</html>